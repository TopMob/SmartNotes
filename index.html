<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SmartNotes</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="Logo.png">
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script async defer src="https://apis.google.com/js/api.js"></script>
    <script async defer src="https://accounts.google.com/gsi/client"></script>
</head>
<body>
    <div class="bg-wrapper"></div>

    <div id="login-screen" class="modal-overlay active">
        <div class="login-box">
            <h1 class="brand-text-fixed">SmartNotes</h1>
            <p class="subtext">Вход в систему</p>
            <div class="auth-buttons-group">
                <button type="button" class="btn-auth google" onclick="Auth.login()">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg" alt="Google">
                    Войти через Google
                </button>
            </div>
        </div>
    </div>

    <div id="app" class="app-layout">
        <aside id="sidebar" class="sidebar-glass">
            <div class="sidebar-header">
                <span class="brand-text-fixed">SmartNotes</span>
                <button type="button" class="btn-icon mobile-only" onclick="UI.toggleSidebar(false)">
                    <i class="material-icons-round">close</i>
                </button>
            </div>
            <nav class="sidebar-nav scrollable">
                <div class="nav-group">
                    <button type="button" class="nav-item active" onclick="switchView('notes')" data-view="notes">
                        <i class="material-icons-round">description</i>
                        <span data-lang="all_notes">Все записи</span>
                    </button>
                    <button type="button" class="nav-item" onclick="switchView('favorites')" data-view="favorites">
                        <i class="material-icons-round">star</i>
                        <span data-lang="favorites">Важное</span>
                    </button>
                    <button type="button" class="nav-item" onclick="switchView('archive')" data-view="archive">
                        <i class="material-icons-round">archive</i>
                        <span data-lang="archive">Архив</span>
                    </button>
                </div>
                <div class="nav-divider"></div>
                <div class="folders-header">
                    <span data-lang="folders">ПАПКИ</span>
                    <button type="button" class="btn-icon-small" id="add-folder-btn">
                        <i class="material-icons-round">add</i>
                    </button>
                </div>
                <div id="folder-list-root" class="folder-list"></div>
            </nav>
            <div class="sidebar-footer">
                <button type="button" class="footer-link" onclick="UI.openModal('about-modal')">
                    <i class="material-icons-round">info</i> <span data-lang="about">О нас</span>
                </button>
                <button type="button" class="footer-link" onclick="UI.openModal('rate-modal')">
                    <i class="material-icons-round">thumb_up</i> <span data-lang="rate">Оценить</span>
                </button>
                <button type="button" class="footer-link" onclick="UI.openSettings()">
                    <i class="material-icons-round">settings</i> <span data-lang="settings">Настройки</span>
                </button>
            </div>
        </aside>

        <main class="main-content">
            <header class="top-bar">
                <div class="header-left">
                    <button type="button" id="menu-toggle" class="btn-icon" onclick="UI.toggleSidebar()">
                        <i class="material-icons-round">menu</i>
                    </button>
                    <h2 id="current-view-title" class="mobile-only-title">SmartNotes</h2>
                </div>
                <div class="search-container">
                    <i class="material-icons-round search-icon">search</i>
                    <input type="text" id="search-input" placeholder="Поиск..." oninput="filterAndRender(this.value)">
                </div>
                <div class="header-right">
                    <div class="user-avatar-wrapper">
                        <img id="user-photo" src="" alt="User" class="header-avatar" onclick="UI.toggleUserMenu()">
                        <div id="user-dropdown" class="dropdown-menu">
                            <div class="dropdown-header">
                                <span id="user-name">...</span>
                            </div>
                            <button type="button" class="dropdown-item" onclick="UI.showConfirm('account', () => Auth.switchAccount())">
                                <i class="material-icons-round">switch_account</i> <span data-lang="switch_acc">Сменить</span>
                            </button>
                            <button type="button" class="dropdown-item danger" onclick="UI.showConfirm('exit', () => Auth.logout())">
                                <i class="material-icons-round">logout</i> <span data-lang="logout">Выйти</span>
                            </button>
                        </div>
                    </div>
                </div>
            </header>

            <div id="notes-content-area" class="content-scrollable scrollable">
                <div id="app-loader" class="loader-container hidden">
                    <div class="spinner"></div>
                </div>
                <div id="empty-state" class="empty-placeholder hidden">
                    <i class="material-icons-round">note_add</i>
                    <p data-lang="empty">Здесь пока пусто</p>
                </div>
                <div id="notes-container" class="notes-grid"></div>
            </div>

            <button type="button" class="btn-fab" onclick="Editor.open()">
                <i class="material-icons-round">add</i>
            </button>
        </main>
    </div>

    <div id="note-editor" class="editor-overlay">
        <div class="editor-container">
            <div class="editor-header-bar">
                <button type="button" class="btn-icon" onclick="Editor.close()">
                    <i class="material-icons-round">arrow_back</i>
                </button>
                <div class="editor-tools">
                    <button type="button" class="btn-icon" onclick="Editor.undo()">
                        <i class="material-icons-round">undo</i>
                    </button>
                    <button type="button" class="btn-icon" onclick="Editor.redo()">
                        <i class="material-icons-round">redo</i>
                    </button>
                    <div class="divider-vertical"></div>
                    <button type="button" class="btn-icon" onclick="Editor.deleteCurrent()">
                        <i class="material-icons-round">delete</i>
                    </button>
                </div>
            </div>
            
            <div class="editor-scroll-area">
                <div id="editor-toolbar" class="editor-toolbar"></div>
                <input type="text" id="note-title" placeholder="Заголовок" autocomplete="off">
                <div id="note-content-editable" class="rich-editor scrollable" contenteditable="true" placeholder="Начните писать..."></div>
            </div>

            <div class="editor-bottom-panel">
                <div class="tags-section">
                    <div id="note-tags-container" class="tags-list-editor"></div>
                    <input type="text" id="note-tags-input" placeholder="#тег (Enter)">
                </div>
                <div class="editor-footer-row">
                    <div class="save-status-wrapper">
                        <button type="button" class="btn-icon active" onclick="Editor.manualSave()" style="color:var(--primary)">
                            <i class="material-icons-round">check</i>
                        </button>
                        <span id="last-edited">Сохранено</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="settings-modal" class="modal-overlay">
        <div class="modal-card">
            <div class="modal-header">
                <h2 data-lang="settings">Настройки</h2>
                <button type="button" class="btn-icon" onclick="UI.closeSettings()">
                    <i class="material-icons-round">close</i>
                </button>
            </div>
            <div class="modal-body scrollable">
                <div class="settings-group">
                    <h3 data-lang="general">Общие</h3>
                    <div class="settings-row">
                        <span data-lang="language">Язык</span>
                        <div class="toggle-switch-lang">
                            <button type="button" class="lang-btn active" onclick="UI.setLang('ru')">RU</button>
                            <button type="button" class="lang-btn" onclick="UI.setLang('en')">EN</button>
                        </div>
                    </div>
                </div>
                
                <div class="settings-group">
                    <h3 data-lang="tools">Инструменты редактора</h3>
                    <div id="tools-config-root" class="tools-config-grid"></div>
                </div>

                <div class="settings-group">
                    <h3 data-lang="appearance">Внешний вид</h3>
                    <p class="subtext" data-lang="presets">Пресеты</p>
                    <div id="theme-picker-root" class="theme-grid"></div>
                    <p class="subtext" style="margin-top:20px;" data-lang="manual">Ручная настройка</p>
                    <div class="color-pickers-grid">
                        <div class="color-picker-item">
                            <span data-lang="c_text">Текст</span>
                            <input type="color" id="cp-text" class="input-color-custom">
                        </div>
                        <div class="color-picker-item">
                            <span data-lang="c_accent">Акцент</span>
                            <input type="color" id="cp-primary" class="input-color-custom">
                        </div>
                        <div class="color-picker-item">
                            <span data-lang="c_bg">Фон</span>
                            <input type="color" id="cp-bg" class="input-color-custom">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="justify-content: space-between;">
                <button type="button" class="btn-secondary" onclick="ThemeManager.reset()" data-lang="reset">Сбросить</button>
                <div style="display:flex; gap:10px;">
                    <button type="button" class="btn-secondary" onclick="UI.closeSettings()" data-lang="close">Закрыть</button>
                    <button type="button" class="btn-primary" onclick="UI.saveSettings()" data-lang="save">Сохранить</button>
                </div>
            </div>
        </div>
    </div>

    <div id="about-modal" class="modal-overlay">
        <div class="modal-card">
            <div class="modal-header">
                <h2 data-lang="team">Команда</h2>
                <button type="button" class="btn-icon" onclick="UI.closeModal('about-modal')">
                    <i class="material-icons-round">close</i>
                </button>
            </div>
            <div class="modal-body">
                <ul class="team-list">
                    <li class="team-member name-alexandrov">Александров Арсений</li>
                    <li class="team-member name-malyshev">Малышев Егор</li>
                    <li class="team-member name-kopaev">Копаев Иван</li>
                    <li class="team-member name-minyaev">Миняев Иван</li>
                </ul>
                <div class="bot-link-wrapper">
                    <span style="color:var(--text-dim); font-size:0.9rem; margin-bottom:5px;" data-lang="contact_us">Связаться с нами:</span>
                    <a href="https://t.me/SmartNotesInfo_bot" target="_blank" rel="noopener noreferrer" class="btn-primary telegram-btn">
                        <i class="material-icons-round">smart_toy</i> @SmartNotesInfo_bot
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div id="rate-modal" class="modal-overlay">
        <div class="modal-card">
            <div class="modal-header">
                <h2 data-lang="rate">Оценить</h2>
                <button type="button" class="btn-icon" onclick="UI.closeModal('rate-modal')">
                    <i class="material-icons-round">close</i>
                </button>
            </div>
            <div class="modal-body">
                <div class="star-rating" style="margin-bottom: 20px;">
                    <i class="material-icons-round star" data-val="1">star_border</i>
                    <i class="material-icons-round star" data-val="2">star_border</i>
                    <i class="material-icons-round star" data-val="3">star_border</i>
                    <i class="material-icons-round star" data-val="4">star_border</i>
                    <i class="material-icons-round star" data-val="5">star_border</i>
                </div>
                <textarea id="feedback-text" placeholder="..." rows="4" class="input-area"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-primary" onclick="UI.submitFeedback()" data-lang="send">Отправить</button>
            </div>
        </div>
    </div>

    <div id="confirm-modal" class="modal-overlay confirm-layer">
        <div class="confirm-box">
            <h3 id="confirm-title">Подтвердите</h3>
            <div style="display:flex; justify-content:center; gap:10px; margin-top:20px;">
                <button type="button" class="btn-secondary" id="confirm-cancel" data-lang="cancel">Отмена</button>
                <button type="button" class="btn-danger" id="confirm-ok" data-lang="yes">Да</button>
            </div>
        </div>
    </div>

    <div id="folder-modal" class="modal-overlay">
        <div class="modal-card">
            <div class="modal-header">
                <h2>Новая папка</h2>
                <button type="button" class="btn-icon" id="close-folder-modal">
                    <i class="material-icons-round">close</i>
                </button>
            </div>
            <div class="modal-body">
                <input type="text" id="folder-name-input" placeholder="Название папки" class="input-area">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-primary" id="save-folder-btn">Создать</button>
            </div>
        </div>
    </div>

    <div id="sketch-modal" class="modal-overlay">
        <div class="modal-card full-screen-modal">
            <div class="modal-header">
                <h2>Зарисовка</h2>
                <div style="display:flex; gap:10px;">
                    <button type="button" class="btn-icon" onclick="SketchService.clear()"><i class="material-icons-round">delete</i></button>
                    <button type="button" class="btn-icon" onclick="UI.closeModal('sketch-modal')"><i class="material-icons-round">close</i></button>
                </div>
            </div>
            <div class="modal-body no-padding" style="background:#fff; position:relative;">
                <canvas id="sketch-canvas" style="width:100%; height:100%; display:block; touch-action:none;"></canvas>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-primary" onclick="SketchService.save()">Вставить</button>
            </div>
        </div>
    </div>

    <div id="voice-indicator" class="voice-indicator">
        <div class="pulse-ring"></div>
        <i class="material-icons-round">mic</i>
        <span>Запись...</span>
    </div>

    <input type="file" id="img-upload" accept="image/*" style="display:none">
    <div id="toast-container" class="toast-container"></div>

    <script src="js/core.js"></script>
    <script src="js/sync.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
